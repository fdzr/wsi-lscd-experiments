{% if not experiment %}
<script type="application/javascript">
    const toggleChildren = (elem, enable) => {
        let allChildNodes = elem.getElementsByTagName('*');

        for(let i = 0; i < allChildNodes.length; i++)
        {
           allChildNodes[i].disabled = enable;
        }
    }
    const updateVectorizer = () => {
        let vectorizer = document.getElementById('vectorizer')
        let options = document.getElementById('vectorizer-options-' + vectorizer.value)
        document.querySelectorAll('[id^="vectorizer-options-"]').forEach((elem) => {
            elem.style.display = 'none'
            toggleChildren(elem, true)
        })
        options.style.display = 'block'
        toggleChildren(options, false)
    }

    const updateClusterer = () => {
        let clusterer = document.getElementById('clusterer')
        let options = document.getElementById('clusterer-options-' + clusterer.value)
        document.querySelectorAll('[id^="clusterer-options-"]').forEach((elem) => {
            elem.style.display = 'none'
            toggleChildren(elem, true)
        })
        options.style.display = 'block'
        toggleChildren(options, false)
    }

</script>
<form action="{{ url_for('solve', task=task | replace(".html", "")) }}" method="POST" enctype="multipart/form-data">
    <div>
        <input class="run-button mdl-button mdl-js-button mdl-button--accent" type="submit" value="Run experiment"/>
    </div>
    <div style="width:100%;">
        <label for="clusterer">Clusterer</label>
        <select style="width:100%" name="clusterer" id="clusterer" onchange="updateClusterer();" class="mdl-select-workaround">
            <option value="AgglomerativeClusterer">AgglomerativeClusterer</option>
            <option value="SubstsProbabilityBasedClusterer">SubstsProbabilityBasedClusterer</option>
            <option value="SubstsFrequencyBasedClusterer">SubstsFrequencyBasedClusterer</option>
        </select>
    </div>
    <div style="width:100%;" id="clusterer-options-AgglomerativeClusterer">
        <p>
            <label for="n_clusters">Number of clusters</label>
            <select multiple style="width:100%" name="n_clusters" id="n_clusters" class="mdl-select-workaround">
                <option selected value="2">2</option>
                <option selected value="3">3</option>
                <option selected value="4">4</option>
                <option selected value="5">5</option>
                <option selected value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </p>
        <p>
            <label for="affinity">Affinity</label>
            <select multiple style="width:100%" name="affinity" id="affinity" class="mdl-select-workaround">
                <option selected value="cosine">Cosine</option>
            </select>
        </p>
        <p>
            <label for="linkage">Linkage</label>
            <select multiple style="width:100%" name="linkage" id="linkage" class="mdl-select-workaround">
                <option selected value="average">Average</option>
            </select>
        </p>
    </div>
    <div style="width:100%;display: none" id="clusterer-options-SubstsProbabilityBasedClusterer">
        <p>
            <label for="n_clusters">Number of clusters</label>
            <select multiple style="width:100%" disabled name="n_clusters" id="n_clusters" class="mdl-select-workaround">
                <option value="1">1</option>
                <option selected value="2">2</option>
                <option selected value="3">3</option>
                <option selected value="4">4</option>
                <option selected value="5">5</option>
                <option selected value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </p>
        <p>
            <label for="linkage">Linkage</label>
            <select multiple disabled style="width:100%" name="linkage" id="linkage" class="mdl-select-workaround">
                <option selected value="arith_average">Arithmetic average</option>
                <option selected value="geo_average">Geometric average</option>
            </select>
        </p>
        <p>
            <label for="left_out_substs_prob_weight">Left out substitutes probability weight</label>
            <select multiple disabled style="width:100%" name="left_out_substs_prob_weight" id="left_out_substs_prob_weight" class="mdl-select-workaround">
                <option selected value="1">1</option>
                <option selected value="0.1">0.1</option>
                <option selected value="0.01">0.01</option>
                <option selected value="0.001">0.001</option>
                <option selected value="0.0001">0.0001</option>
                <option selected value="0">0</option>
            </select>
        </p>
    </div>
    <div style="width:100%;display: none" id="clusterer-options-SubstsFrequencyBasedClusterer">
        <p>
            <label for="n_clusters">Number of clusters</label>
            <select multiple style="width:100%"  disabled name="n_clusters" id="n_clusters" class="mdl-select-workaround">
                <option value="1">1</option>
                <option selected value="2">2</option>
                <option selected value="3">3</option>
                <option selected value="4">4</option>
                <option selected value="5">5</option>
                <option selected value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
        </p>
        <p>
            <label for="softmax_temperature">Softmax Temperature (lower means promote frequent substitutes even more)</label>
            <select multiple disabled style="width:100%" name="softmax_temperature" id="softmax_temperature" class="mdl-select-workaround">
                <option selected value="0.0001">0.0001</option>
                <option selected value="0.01">0.01</option>
                <option selected value="0.25">0.25</option>
                <option selected value="0.5">0.5</option>
                <option selected value="1">1</option>
                <option selected value="2">2</option>
                <option selected value="4">4</option>
                <option selected value="1">1</option>
                <option selected value="8">8</option>
            </select>
        </p>
    </div>
    <p style="width:100%;">
        <label for="vectorizer">Vectorizer</label>
        <select style="width:100%" id="vectorizer" name="vectorizer" onchange="updateVectorizer();" class="mdl-select-workaround">
            <option value="SubstsTfidfVectorizer">SubstsTfidfVectorizer</option>
            <option value="SubstsProbabilityBasedVectorizer">SubstsProbabilityBasedVectorizer</option>
            <option value="SubstsFrequencyBasedVectorizer">SubstsFrequencyBasedVectorizer</option>
        </select>
    </p>
    <div style="width:100%;" id="vectorizer-options-SubstsTfidfVectorizer">
        <p>
            <label for="analyzer">Analyzer</label>
            <select multiple style="width:100%" name="analyzer" id="analyzer" class="mdl-select-workaround">
                <option selected value="word">Word</option>
            </select>
        </p>
        <p>
            <label for="min_df">Min df (comma separated)</label>
            <input type="text" class="mdl-textfield__input" name="min_df" id="min_df" value="0.03" />
        </p>
        <p>
            <label for="max_df">Max df (comma separated)</label>
            <input type="text" class="mdl-textfield__input" name="max_df" id="max_df" value="0.8" />
        </p>
        <p>
            <label for="topk">TOP K (comma separated)</label>
            <input type="text" class="mdl-textfield__input" name="topk" id="topk" value="150" />
        </p>
    </div>
    <div style="width:100%;display: none" id="vectorizer-options-SubstsProbabilityBasedVectorizer">
        <p>
            <label for="topk">TOP K (comma separated)</label>
            <input type="text"  disabled class="mdl-textfield__input" name="topk" id="topk" value="150" />
        </p>
    </div>
    <div style="width:100%;display: none" id="vectorizer-options-SubstsFrequencyBasedVectorizer">
        <p>
            <label for="topk">TOP K (comma separated)</label>
            <input type="text"  disabled class="mdl-textfield__input" name="topk" id="topk" value="150" />
        </p>
        <p>
            <label for="analyzer">Analyzer</label>
            <select multiple style="width:100%"  disabled name="analyzer" id="analyzer" class="mdl-select-workaround">
                <option selected value="word">Word</option>
            </select>
        </p>
    </div>
    <div>
        <p>
            <label for="sample_size">Sample size (if the dataset has two corpora, the size is per corpora)</label>
            <input type="text" class="mdl-textfield__input" name="sample_size" id="sample_size" value="1000" />
        </p>
    </div>
    <div>
        <p>
            <label for="random_seed">Random seed (random seed to use for sampling, for reproducibility)</label>
            <input type="text" class="mdl-textfield__input" name="random_seed" id="random_seed" value="1" />
        </p>
    </div>
    <div class="mdl-textfield mdl-js-textfield">
        <textarea class="mdl-textfield__input" name="target_words" id="target_words" >{{ experiment.target_words|join('\r\n') if experiment else '' }}</textarea>
        <label class="mdl-textfield__label" for="target_words">Target words (will use all words in the dataset if not specified)</label>
    </div>
    <div class="corpus-file-inputs">
        <label for="select_dataset_id">Choose a dataset</label>
        <select style="display:block" name="selected_dataset_id" id="select_dataset_id" class="mdl-select-workaround">
            <option value="">Select dataset</option>
            {% for dataset in datasets %}
                <option value="{{ dataset._id }}">{{ dataset._id }}</option>
            {% endfor %}
        </select>
        <br />
        <a href="{{ url_for('dataset_get') }}" class="mdl-button mdl-js-button mdl-button--colored">...or upload a new one</a>
    </div>

</form>
{% else %}
    {% with experiment=experiment, subtask=subtask, datasets=datasets %}
        {% include task~'/'~subtask~'-panel.html' %}
    {% endwith %}
{% endif %}